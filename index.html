<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Single Line converter</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <style>
        .err{
            color:white;
            background-color: red;
        }
        .good{
            color:black;
            background-color: white;
        }
        .comment{
            color:green;
        }
        </style>
  </head>
  <body>
    <div class="container">
        <h1 class = "text-center">Paste Here</h1>
        <p class = "text-center">There is this <em>one</em> manuel that provides txt versions of their code but without any line breaks. Here is a tool to make your life easier:</p>
        <p class = "text-center">(Code in red requires the user to figure out where to put the line break)</p>
        <div id="txt" contenteditable="true" style="border-style: solid; border-radius:5px;border-width:1px">
            TXT in your clipboard appears here
        </div>
      
<br>
<button type="button" onclick="copy()" class="btn btn-primary btn-lg btn-block">COPY</button>
<button type="button" onclick="del()" class="btn btn-danger btn-lg btn-block">Delete Comments (make sure to fix errors first)</button>
<div class="text-center">
                         <h6>Quick Links</h6>
                          <a href="https://login.microsoftonline.com/te/franchiczar.onmicrosoft.com/b2c_1a_signin_codeninjas/oauth2/v2.0/authorize?client_id=0af8d70e-0159-4497-bf82-7e6498d1cf46&redirect_uri=https%3A%2F%2Fdojo.code.ninja&response_mode=form_post&response_type=code%20id_token&scope=openid%20profile%20offline_access%20https%3A%2F%2Ffranchiczar.onmicrosoft.com%2Ffranchiczar.com%2Fuser.read&state=OpenIdConnect.AuthenticationProperties%3D1uDElVoLSjTGEnNSASZrL85DLz_RdxwKx5ciMj8O6UVzEQtFk_rkrAsd7BLKdCZ5qoRnLsu915Nntjt08VvOyqj5yIrSaxPcMTKfqWe9cKh5UerypTEDAweaZLThoZDG12TJ9Au0arQFB_id1WjdOocL7r1aUXLiJMiGBJlVZBqsoF_9hMX2tKggrXC_D_T1Zj4ZHcBKwYoDRNU2L7Sw-w&nonce=636902531150061243.NTAxMDkwMDUtZDNjNC00YTI0LWE0ZDgtY2ZmOWIyZmRkMTIzOGQwZWIxMDYtYTc0YS00Y2E4LTg0YTMtMzcwYjQ4NThkZTA1&x-client-SKU=ID_NET451&x-client-ver=5.2.1.0">Sensei Sign in</a>
                          <a href="https://online.flowpaper.com/7831075c/OrangeBeltv2r13/">Orange Belt</a>
                          <a href="https://dojo.code.ninja/students/curriculum/cn-nj-kendall-park/view/qezntsub1m/">Yellow Belt</a>
                          <a href="https://dojo.code.ninja/students/curriculum/cn-nj-kendall-park/7uwdzqq7ip/index.html">White Belt</a>
 </div> 
    </div> 
<!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
      <script>
          var perm = "prompt"
          var oldtxt = "";
          var oldtxtBox = document.getElementById("txt").innerText;
          navigator.permissions.query({
                name: 'clipboard-read'
            }).then(permissionStatus => {
            // Will be 'granted', 'denied' or 'prompt':
            console.log(permissionStatus.state);
            perm = permissionStatus.state

            // Listen for changes to the permission state
            permissionStatus.onchange = () => {
                console.log(permissionStatus.state);
                perm = permissionStatus.state
            };
            });
            navigator.clipboard.readText()
          setInterval(()=>{
              if(perm=="granted"){
                navigator.clipboard.readText().then(text => {
                    //document.getElementById("txt").innerText = text
                    if(oldtxt != text){
                        parse(text,false);
                        oldtxt = text
                        oldtxtBox = document.getElementById("txt").innerText
                    }
                });
              }
                  if(oldtxtBox!=document.getElementById("txt").innerText){
                    oldtxtBox = document.getElementById("txt").innerText
                    parse(oldtxtBox,false);
                  }
                

          },500)

          function parse(str,del){
              var out = "";
              var line = "";
              while(str.length>0){
                var char = str.substring(0,1)
                    var nextChar = ""
                if(str.length>1)
                    nextChar = str.substring(1,2)
                if((!line.includes("for(")&&char==";")||char=="{"){
                    line+=char;
                    out+=line+"\n";
                    line = "";
                }else if(char=="}"){
                    out+=line+"\n"+char+"\n";
                    line = "";
                }else if(char+nextChar=="//"){
                    out+=line+"\n";
                    line = char;
                    console.log(out)
                }else if(char=="\n"&&nextChar=="\n"){
                    //Do nothing
                }else{
                    line+=char;
                }
                str = str.substring(1)
              }
              out+=line
              str = out;
              out = "";
              line=""
              while(str.length>0){
                var char = str.substring(0,1)
                var nextChar = ""
                if(str.length>1)
                nextChar = str.substring(1,2)
                if(char=="\n"&&nextChar=="\n"){
                    //Do nothing
                    console.log("DOYBLE")
                }else  if(char=="\n"&&line.trim()!=""){
                    if(del){
                        if(!line.includes("//"))
                            out+= turnToHTML(line)+"<br>";
                    }else{
                        out+= turnToHTML(line)+"<br>";
                    }

                    line = ""
                }else{
                    line+=char;
                }
                str = str.substring(1)
              }
              if(del){
                 if(!line.includes("//"))
                      out+= turnToHTML(line);
                 }else{
                     out+= turnToHTML(line);
                 }
              console.log(out)
              document.getElementById("txt").innerHTML = out

              
          }

          function turnToHTML(str){
              var classs = "";
              var title = ""
              if(str.includes("//")&&(str.includes(";")||str.includes("{"))){
                classs = "err";
                title="There should probably be an line break somewhere here"
              }else if(str.includes("//")){
                classs = "comment";
                title="This is a comment"
              }else {
                classs = "good";
                title = "No errors found"
              }
              return "<span title=\""+title+"\" class=\""+classs+"\">"+str.replace("“","\"").replace("”","\"")+"</span>"
          }

          function del(){
            parse(document.getElementById("txt").innerText,true);
          }

          function copy(){
            var txt = document.getElementById("txt").innerText;
            navigator.clipboard.writeText(txt)

          }

          </script>
</body>
</html>
     
    
